<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>AbstractPermutation interface · AbstractPermutations.jl</title><meta name="title" content="AbstractPermutation interface · AbstractPermutations.jl"/><meta property="og:title" content="AbstractPermutation interface · AbstractPermutations.jl"/><meta property="twitter:title" content="AbstractPermutation interface · AbstractPermutations.jl"/><meta name="description" content="Documentation for AbstractPermutations.jl."/><meta property="og:description" content="Documentation for AbstractPermutations.jl."/><meta property="twitter:description" content="Documentation for AbstractPermutations.jl."/><meta property="og:url" content="https://kalmarek.github.io/AbstractPermutations.jl/abstract_api/"/><meta property="twitter:url" content="https://kalmarek.github.io/AbstractPermutations.jl/abstract_api/"/><link rel="canonical" href="https://kalmarek.github.io/AbstractPermutations.jl/abstract_api/"/><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../search_index.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../">AbstractPermutations.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li class="is-active"><a class="tocitem" href><code>AbstractPermutation</code> interface</a><ul class="internal"><li><a class="tocitem" href="#Mandatory-methods"><span>Mandatory methods</span></a></li><li><a class="tocitem" href="#Suplementary-methods"><span>Suplementary methods</span></a></li><li><a class="tocitem" href="#Example-implementation"><span>Example implementation</span></a></li></ul></li><li><a class="tocitem" href="../misc/">Other functions</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href><code>AbstractPermutation</code> interface</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href><code>AbstractPermutation</code> interface</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/kalmarek/AbstractPermutations.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/kalmarek/AbstractPermutations.jl/blob/main/docs/src/abstract_api.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="The-AbstractPermutation-interface"><a class="docs-heading-anchor" href="#The-AbstractPermutation-interface">The <code>AbstractPermutation</code> interface</a><a id="The-AbstractPermutation-interface-1"></a><a class="docs-heading-anchor-permalink" href="#The-AbstractPermutation-interface" title="Permalink"></a></h1><p>The <code>AbstractPermutation</code> interface consists of just three mandatory functions. Note that none of them is exported, hence it is safe to <code>import</code>/<code>using</code> the package without introducing any naming conflicts with other packages.</p><h2 id="Mandatory-methods"><a class="docs-heading-anchor" href="#Mandatory-methods">Mandatory methods</a><a id="Mandatory-methods-1"></a><a class="docs-heading-anchor-permalink" href="#Mandatory-methods" title="Permalink"></a></h2><p>The three mandatory methods are:</p><ul><li>a constructor,</li><li><code>AbstractPermutations.degree</code> and</li><li><code>Base.^</code>.</li></ul><div class="admonition is-info"><header class="admonition-header">Note</header><div class="admonition-body"><p>The meaning of <code>degree</code> doesn&#39;t have a well established tradition in mathematics. This is still ok, as long as we define its meaning with care for precision and use it in a consistent and predictable way.</p></div></div><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="AbstractPermutations.AbstractPermutation" href="#AbstractPermutations.AbstractPermutation"><code>AbstractPermutations.AbstractPermutation</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">AbstractPermutation</code></pre><p>Abstract type representing bijections of positive integers <code>ℕ = {1,2,…}</code> finitely supported. That is, we treat permutations as functions <code>ℕ → ℕ</code> such that for every permutation <code>σ</code> there are only finitely many <code>k</code> different from their image under <code>σ</code>.</p><p><strong>Mandatory interface</strong></p><p>Subtypes <code>APerm &lt;: AbstractPermutation</code> must implement the following functions:</p><ul><li><code>APerm(images::AbstractVector{&lt;:Integer}[; check::Bool=true])</code> - a constructor of a <code>APerm</code> from a vector of images. Optionally the keyword argument <code>check</code> may be set to <code>false</code> when the caller knows that <code>images</code> constitute a honest permutation.</li><li><a href="#Base.:^-Tuple{Integer, AbstractPermutations.AbstractPermutation}"><code>Base.:^(i::Integer, σ::APerm)</code></a> the customary notation for the image of <code>i</code> under <code>σ</code>.</li><li><a href="#AbstractPermutations.degree"><code>degree(σ::APerm)</code></a> the minimal <code>d ≥ 0</code> such that <code>σ</code> fixes all <code>k ≥ d</code>.</li></ul><div class="admonition is-info"><header class="admonition-header">Note</header><div class="admonition-body"><p>There is no formal requirement that the <code>APerm(images)</code> constructor actually returns a <code>APerm</code>. Any <code>AbstractPermutation</code> object would do. This may be useful if constructing permutation from images is not technically feasible.</p></div></div><div class="admonition is-info"><header class="admonition-header">Note</header><div class="admonition-body"><p>If <code>APerm</code> is not constructable from type one needs to implement <code>one(::APerm)</code>.</p></div></div><div class="admonition is-category-warn"><header class="admonition-header">Warn</header><div class="admonition-body"><p>Even though <code>AbstractPermutation &lt;: GroupsCore.GroupElement</code> they don&#39;t necessarily implement the whole of <code>GroupElement</code> interface, e.g. it is possible to implement <code>parent</code>-less permutations.</p></div></div><p><strong>Optional interface</strong></p><ul><li><a href="#AbstractPermutations.perm"><code>perm(σ::APerm)</code></a> by default returns <code>σ</code> - the &quot;simplest&quot; (implementation-wise) permutation underlying <code>σ</code>.</li><li><a href="#AbstractPermutations.inttype"><code>inttype(::Type{&lt;:APerm})</code></a> by default returns <code>UInt32</code>.</li><li><a href="#AbstractPermutations.__unsafe_image"><code>__unsafe_image(i::Integer, σ::APerm)</code></a> defaults to <code>i^σ</code>.</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/kalmarek/AbstractPermutations.jl/blob/e07568f858bb4aaa6a8b76537d3a1623e57aabd6/src/abstract_perm.jl#L1-L37">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="AbstractPermutations.degree" href="#AbstractPermutations.degree"><code>AbstractPermutations.degree</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">degree(σ::AbstractPermutation)</code></pre><p>Return a minimal number <code>n ≥ 0</code> such that <code>k^σ == k</code> for all <code>k &gt; n</code>.</p><p>Such number <code>n</code> can be understood as a <em>degree</em> of a permutation, since we can regard <code>σ</code> as an element of <code>Sym(n)</code> (and not of <code>Sym(n-1)</code>).</p><div class="admonition is-info"><header class="admonition-header">Note</header><div class="admonition-body"><p>By this convention <code>degree</code> of the identity permutation is equal to <code>0</code> and it is the only permutation with this property. Also by this convention there is no permutation with <code>degree</code> equal to <code>1</code>.</p></div></div></div><a class="docs-sourcelink" target="_blank" href="https://github.com/kalmarek/AbstractPermutations.jl/blob/e07568f858bb4aaa6a8b76537d3a1623e57aabd6/src/abstract_perm.jl#L40-L51">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Base.:^-Tuple{Integer, AbstractPermutations.AbstractPermutation}" href="#Base.:^-Tuple{Integer, AbstractPermutations.AbstractPermutation}"><code>Base.:^</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">^(i::Integer, σ::AbstractPermutation)</code></pre><p>Return the image of <code>i</code> under <code>σ</code> preserving the type of <code>i</code>.</p><p>We consider <code>σ</code> as a permutation of <code>ℕ</code> (the positive integers), with finite support, so <code>k^σ = k</code> for all <code>k &gt; degree(σ)</code>.</p><div class="admonition is-category-warn"><header class="admonition-header">Warn</header><div class="admonition-body"><p>The behaviour of <code>i^σ</code> for <code>i ≤ 0</code> is undefined and can not be relied upon.</p></div></div></div><a class="docs-sourcelink" target="_blank" href="https://github.com/kalmarek/AbstractPermutations.jl/blob/e07568f858bb4aaa6a8b76537d3a1623e57aabd6/src/abstract_perm.jl#L61-L70">source</a></section></article><h2 id="Suplementary-methods"><a class="docs-heading-anchor" href="#Suplementary-methods">Suplementary methods</a><a id="Suplementary-methods-1"></a><a class="docs-heading-anchor-permalink" href="#Suplementary-methods" title="Permalink"></a></h2><p>Moreover there are three internal, suplementary functions that may be overloaded by the implementer, if needed (mostly for performance reasons).</p><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="AbstractPermutations.inttype" href="#AbstractPermutations.inttype"><code>AbstractPermutations.inttype</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">inttype(σ::Type{&lt;:AbstractPermutation})</code></pre><p>Return the underlying &quot;storage&quot; integer.</p><div class="admonition is-category-warn"><header class="admonition-header">Warn</header><div class="admonition-body"><p><strong>For internal use only.</strong></p></div></div><p>The intention is to provide optimal storage type when the <code>images</code> vector constructor is used (to save allocations and memory copy). For example a hypothetic permutation <code>Perm8</code> of elements up to length <code>255</code> may alter the default to <code>UInt8</code>.</p><p>The default is <code>UInt32</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/kalmarek/AbstractPermutations.jl/blob/e07568f858bb4aaa6a8b76537d3a1623e57aabd6/src/abstract_perm.jl#L107-L120">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="AbstractPermutations.perm" href="#AbstractPermutations.perm"><code>AbstractPermutations.perm</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">perm(p::AbstractPermutation)</code></pre><p>Return the &quot;bare-metal&quot; permutation (unwrap). Return <code>σ</code> by default.</p><div class="admonition is-category-warn"><header class="admonition-header">Warn</header><div class="admonition-body"><p><strong>For internal use only.</strong></p></div></div><p>Provide access to wrapped permutation object. For &quot;bare-metal&quot; permutations this method needs to return the identical (i.e. `<code>===</code>) object.</p><p>The intention of this method is to provide an un-wrapped permutations to computationally intensive algorithms, so that the external wrappers (if present) do not hinder the performance.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/kalmarek/AbstractPermutations.jl/blob/e07568f858bb4aaa6a8b76537d3a1623e57aabd6/src/abstract_perm.jl#L91-L104">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="AbstractPermutations.__unsafe_image" href="#AbstractPermutations.__unsafe_image"><code>AbstractPermutations.__unsafe_image</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">__unsafe_image(i::Integer, σ::AbstractPermutation)</code></pre><p>The same as <code>i^σ</code>, but assuming that <code>i ∈ Base.OneTo(degree(σ))</code>.</p><div class="admonition is-category-warn"><header class="admonition-header">Warn</header><div class="admonition-body"><p>The caller is responsible for checking the assumption. Failure to do so may (and probably will) lead to segfaults in the best case scenario and to silent data corruption in the worst!.</p></div></div></div><a class="docs-sourcelink" target="_blank" href="https://github.com/kalmarek/AbstractPermutations.jl/blob/e07568f858bb4aaa6a8b76537d3a1623e57aabd6/src/abstract_perm.jl#L80-L88">source</a></section></article><h2 id="Example-implementation"><a class="docs-heading-anchor" href="#Example-implementation">Example implementation</a><a id="Example-implementation-1"></a><a class="docs-heading-anchor-permalink" href="#Example-implementation" title="Permalink"></a></h2><p>For an example, very simple implementation of the <code>AbstractPermutation</code> interface you may find in <code>ExamplePerms</code> module defined in <a href="https://github.com/kalmarek/AbstractPermutations.jl/blob/main/test/perms_by_images.jl"><code>perms_by_images.jl</code></a>.</p><p>Here we provide an alternative implementation which keeps the internal storage at fixed length.</p><h3 id="Implementing-mandatory-methods"><a class="docs-heading-anchor" href="#Implementing-mandatory-methods">Implementing mandatory methods</a><a id="Implementing-mandatory-methods-1"></a><a class="docs-heading-anchor-permalink" href="#Implementing-mandatory-methods" title="Permalink"></a></h3><pre><code class="language-julia hljs">import AbstractPermutations
struct APerm{T} &lt;: AbstractPermutations.AbstractPermutation
    images::Vector{T}
    degree::Int

    function APerm{T}(images::AbstractVector{&lt;:Integer}; check::Bool=true) where T
        if check
            isperm(images) || throw(ArgumentError(&quot;`images` vector is not a permutation&quot;))
        end
        deg = something(findlast(i-&gt;images[i] ≠ i, eachindex(images)), 0)
        return new{T}(images, deg)
    end
end</code></pre><p>Above we defined permutations by storing the vector of their images together with the computed degree <code>deg</code>.</p><p>Now we need to implement the remaining two functions which will be simple enough:</p><pre><code class="language-julia hljs">AbstractPermutations.degree(p::APerm) = p.degree
function Base.:^(i::Integer, p::APerm)
    deg = AbstractPermutations.degree(p)
    # make sure that we return something of the same type as `i`
    return 1 ≤ i ≤ deg ? oftype(i, p.images[i]) : i
end</code></pre><p>With this the interface is implementation is complete. To test whether the implementation follows the specification a test suite is provided:</p><pre><code class="language-julia hljs">include(joinpath(pkgdir(AbstractPermutations), &quot;test&quot;, &quot;abstract_perm_API.jl&quot;))
abstract_perm_interface_test(APerm{UInt16})</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi"><span class="sgr1">Test Summary:                                                              | <span class="sgr32">Pass  </span><span class="sgr36">Total  </span>Time</span>
AbstractPermutation API test: Main.APerm{UInt16} | <span class="sgr32">  95  </span><span class="sgr36">   95  </span>0.3s</code></pre><h3 id="Suplementary-Methods"><a class="docs-heading-anchor" href="#Suplementary-Methods">Suplementary Methods</a><a id="Suplementary-Methods-1"></a><a class="docs-heading-anchor-permalink" href="#Suplementary-Methods" title="Permalink"></a></h3><p>Since in <code>APerm{T}</code> we store images as a <code>Vector{T}</code>, to avoid spurious allocations we may define</p><pre><code class="language-julia hljs">AbstractPermutations.inttype(::Type{APerm{T}}) where T = T</code></pre><p>There is no need to define <code>AbstractPermutations.perm</code> as <code>APerm</code> is already very low level and suitable for high performance code-paths.</p><p>Finally to squeeze even more performance one could define <code>__unsafe_image</code> with the same semantics as <code>n^σ</code> under the assumption that <code>n</code> belongs to <code>Base.OneTo(degree(σ))</code>:</p><pre><code class="language-julia hljs">@inline function AbstractPermutations.__unsafe_image(n::Integer, σ::APerm)
    return oftype(n, @inbounds σ.images[n])
end</code></pre></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../">« Home</a><a class="docs-footer-nextpage" href="../misc/">Other functions »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="auto">Automatic (OS)</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.2.1 on <span class="colophon-date" title="Sunday 17 December 2023 12:13">Sunday 17 December 2023</span>. Using Julia version 1.9.4.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
